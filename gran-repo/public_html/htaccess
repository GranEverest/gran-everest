RewriteEngine On
DirectoryIndex index.html

# Canonical: HTTPS + sin www
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301,NE]

# Dejar pasar estáticos
RewriteRule ^_next/ - [L]
RewriteRule ^assets/ - [L]
RewriteRule ^admin/ - [L]
RewriteRule ^favicon\.ico$ - [L]
RewriteRule ^robots\.txt$ - [L]
RewriteRule ^sitemap\.xml$ - [L]

# Extensión .html implícita en top-level
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^/?]+)$ $1.html [L]

# /borrow compatible (carpeta o archivo)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^borrow/?$ /borrow/index.html [L]

# 404
ErrorDocument 404 /404.html

# Cache para estáticos
<IfModule mod_headers.c>
  <FilesMatch "\.(js|css|png|jpg|jpeg|svg|webp|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
</IfModule>
